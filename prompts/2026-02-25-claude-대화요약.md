# OpenClaw 자동매매 시스템 현황 (2026-02-25)

> Claude 대화요약 — 2026-02-25

---

## 서버 정보

| 항목 | 값 |
|------|-----|
| 인스턴스 | GCP e2-small |
| IP | 34.158.207.190 |
| 포트 | 8080 |
| 계정 | wlsdud5035 |
| 경로 | /home/wlsdud5035/.openclaw/workspace |
| 대시보드 | http://34.158.207.190:8080 |
| GitHub | https://github.com/zln02/openclaw-trading (Private) |

---

## 시스템 구조

```
workspace/
├── btc/
│   ├── btc_trading_agent.py   # BTC 자동매매
│   ├── btc_indicators.py
│   ├── btc_news_collector.py
│   └── btc_dashboard.py       # FastAPI 대시보드 (BTC+주식)
├── stocks/
│   ├── stock_trading_agent.py # 주식 자동매매
│   ├── stock_premarket.py     # 장 전 AI 브리핑
│   ├── stock_data_collector.py# DART+yfinance 수집
│   └── kiwoom_client.py       # 키움 REST API
├── scripts/
│   ├── run_btc_cron.sh
│   └── run_dashboard.sh
└── schema/
    ├── btc_trades_schema.sql
    └── automated_trading_schema.sql
```

---

## Cron 스케줄 (wlsdud5035)

| 스케줄 | 설명 |
|--------|------|
| `*/5 * * * *` | BTC 메인 사이클 |
| `* * * * *` | BTC 1분 손절/익절 체크 |
| `0 * * * *` | BTC 매시 리포트 |
| `*/5 * * * 1-5` | 주식 메인 사이클 (평일) |
| `* * * * 1-5` | 주식 1분 손절/익절 (평일) |
| `0 8 * * 1-5` | 주식 장 전 브리핑 |
| `0 9 * * 1-5` | OHLCV 수집 |
| `@reboot` | 대시보드 자동 시작 |

---

## BTC 봇 기능

**전략**
- 멀티타임프레임 (5분봉 + 1시간봉)
- RSI / MACD / 볼린저밴드
- Fear & Greed Index
- 뉴스 감정분석 (CoinDesk RSS)
- 거래량 분석
- 분할매수 3단계
- 손절 -2% / 익절 +4%
- 일일 손실 한도 -5%
- 공포 극복 전략 (F&G≤10 + RSI≤25 + 거래량≥0.8배)
- 변동성 폭발 전략 (거래량 3배 이상)
- 김치 프리미엄 전략 (-2% 저평가)

**실행 모드**
- `python3 btc_trading_agent.py` — 전체 사이클
- `python3 btc_trading_agent.py check` — 1분 손절/익절
- `python3 btc_trading_agent.py report` — 매시 리포트

---

## 주식 봇 기능

- **종목**: 20개 (삼성전자, SK하이닉스, 한미반도체 등)
- **API**: 키움증권 모의투자 REST API
- **계좌**: 81201258

**전략**
- RSI / MACD / 볼린저밴드
- 거래량 분석
- 뉴스 감정분석 (연합/한경 RSS)
- 멀티타임프레임 (일봉 + 주봉)
- 코스피 시장 심리 (^KS11 RSI)
- 분할매수 3단계
- 손절 -3% / 익절 +6%
- 일일 손실 한도 -5%
- 최대 동시 보유 3종목

**필터**
- 거래량 급감 차단 (BLOCKED_VOLUME)
- 볼린저밴드 상단 차단 (BLOCKED_BB)
- 코스피 과열 차단 (BLOCKED_KOSPI)
- 주봉 하락추세 차단 (BLOCKED_WEEKLY)
- 장 외 시간 자동 스킵 (09:00~15:30)

**실행 모드**
- `python3 stock_trading_agent.py` — 전체 사이클
- `python3 stock_trading_agent.py check` — 1분 손절/익절

---

## Supabase 테이블

**BTC**
- `btc_trades` — 매매 로그
- `btc_position` — 포지션

**주식**
- `top50_stocks` — 20종목 기본정보 ✅ 데이터 있음
- `daily_ohlcv` — 20종목 30일치 ✅ 데이터 있음
- `financial_statements` — 재무제표 ⏳ DART 키 필요
- `trade_executions` — 매매 로그 ✅ created_at 추가됨
- `daily_reports` — 일별 성과
- `disclosures` — 공시

---

## 환경변수 (.env)

- UPBIT_ACCESS_KEY, UPBIT_SECRET_KEY
- SUPABASE_URL, SUPABASE_SECRET_KEY
- OPENAI_API_KEY
- TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID
- KIWOOM_REST_API_KEY, KIWOOM_REST_API_SECRET
- KIWOOM_ACCOUNT_NO=81201258
- TRADING_ENV=mock
- OPENDART_API_KEY

---

## 대시보드

- **BTC**: http://34.158.207.190:8080
- **주식**: http://34.158.207.190:8080/stocks

**BTC 기능**
- ✅ 캔들차트 (1분/5분/15분/1시간 버튼)
- ✅ 거래량 히스토그램
- ✅ BUY/SELL 마커
- ✅ 실시간 로그 (색상 구분)
- ✅ Fear & Greed / RSI / MACD
- ✅ 포지션 현황
- ✅ 거래 내역
- ✅ 뉴스

**주식 기능**
- ✅ 20종목 그리드 (가격/등락률)
- ✅ 캔들차트 (종목 클릭)
- ✅ AI 전략 표시
- ✅ 실시간 로그
- ⏳ 차트 인터벌 버튼 (5분/10분/1시간/일봉) → 미완성

---

## 지금 해야 할 것

1. **주식 차트 인터벌 버튼 추가** (5분/10분/1시간/일봉)
   - btc_dashboard.py STOCKS_HTML 수정
   - /api/stocks/chart/{code}에 interval 파라미터 추가
   - yfinance로 각 인터벌 데이터 반환

2. **GitHub 푸시**
   ```bash
   git remote set-url origin https://zln02@github.com/zln02/openclaw-trading.git
   git push origin main
   ```
   (Personal Access Token 입력)

3. **DART API 키 등록**
   - OPENDART_API_KEY가 openclaw.json에 있음
   - `python3 stocks/stock_data_collector.py financials`

4. **내일 장 시작 (09:00) 확인**
   - 08:00 텔레그램 장 전 브리핑
   - 09:00 OHLCV 수집
   - 09:00~ 주식 매매 신호

---

## 대시보드 재시작 명령어

```bash
sudo pkill -f btc_dashboard
sudo -u wlsdud5035 bash -c 'cd /home/wlsdud5035/.openclaw/workspace && nohup .venv/bin/python btc/btc_dashboard.py >> /home/wlsdud5035/.openclaw/logs/dashboard.log 2>&1 &'
```
